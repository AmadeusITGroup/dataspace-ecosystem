# Default values for kafka-proxy
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []

# Kafka Proxy Manager configuration
kafkaProxy:
  # Manager application settings
  manager:
    # EDC Kafka Proxy Manager image
    image:
      registry: ""
      repository: ""
      tag: ""
      pullPolicy: IfNotPresent

    initContainers:
      - name: cert-installer
        command:
          - /bin/sh
        volumeMounts:
          - name: cert-volume
            mountPath: /certs
          - name: cacerts-volume
            mountPath: /certificates
        image: 'eclipse-temurin:21.0.9_10-jre-alpine-3.23'
        args:
          - '-c'
          - |
            cp $JAVA_HOME/lib/security/cacerts /certificates/cacerts
            keytool -import -trustcacerts -keystore /certificates/cacerts \
              -storepass changeit -noprompt -alias vaultCa -file /certs/tls.crt

    # Resource limits and requests
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
    
    # Kafka Proxy Configuration
    vaultAddr: "http://vault:8200"
    vaultTokenSecret:
      # Name of the secret containing the Vault token
      name: "vault-token"
      # Key within the secret that contains the token
      key: "token"
    # Vault TLS Configuration
    vaultTls:
      # Enable TLS verification for Vault connection
      enabled: true
      # CA certificate for verifying Vault's TLS certificate
      # Can be provided as a secret name or inline PEM content
      caCert:
        # Secret containing the CA certificate
        secret: "tls-ca"
        # Key within the secret containing the CA cert (default: ca.crt)
        key: "tls.crt"
        path: "/vault-ca/tls.crt"
    vaultFolder: ""
    namespace: "default"
    proxyImage: "grepplabs/kafka-proxy:0.4.2"
    sharedDir: "/shared"
    certDir: "/certificates"
    checkInterval: 15
    enableLock: true
    lockFilePath: "/tmp/kubectl-deployer.lock"
    
    # Participant identification for proxy ownership
    # Used to prevent cross-consumer proxy deletion
    # If not set, falls back to EDC_PARTICIPANT_ID environment variable
    participantId: ""
    
    # Service fixed ClusterIP (optional)
    # If specified, the Kafka proxy service will be created with this fixed IP address
    # The IP must be within the service CIDR range of your cluster
    # Leave empty to let Kubernetes assign an IP automatically
    serviceClusterIP: ""
    
    # Base proxy port for Kafka proxy instances
    # This is the port that will be used for the Kafka proxy service
    # Default: 30001
    baseProxyPort: 30001
    
    # Maximum number of broker ports to expose
    # For multi-broker Kafka clusters, the proxy needs to expose sequential ports
    # starting from baseProxyPort+1 up to baseProxyPort+maxBrokerPorts
    # This should be set to at least the number of brokers in your largest Kafka cluster
    # Default: 20 (supports clusters with up to 20 brokers)
    maxBrokerPorts: 20
    
    # Downstream Authentication Configuration
    # Configures how clients authenticate to the proxy's listener
    auth:
      enabled: false
      # Authentication mechanism: PLAIN or OAUTHBEARER
      # PLAIN: Hybrid JWT-over-PLAIN using entra-token-verifier (accepts JWT as password)
      # OAUTHBEARER: Proper OAuth2 flow using entra-token-info (implements TokenInfo interface)
      mechanism: "PLAIN"  # Options: PLAIN, OAUTHBEARER
      tenantId: ""
      clientId: ""
      # Static users for fallback authentication (comma-separated username:password pairs)
      # Only used with PLAIN mechanism
      staticUsers: ""
      # Custom image with authentication plugins (entra-token-verifier, entra-token-info)
      image: ""
    
    # TLS Listener Configuration
    tls:
      listener:
        enabled: false
        certSecret: ""
        keySecret: ""
        caSecret: ""
    
    # EDC Runtime configuration (optional)
    edc:
      runtimeId: ""
      keystore: ""
      keystorePassword: ""
      vault:
        clientId: ""
        tenantId: ""
        clientSecret: ""
        name: ""

# Service configuration
service:
  type: ClusterIP
  port: 8080
  managementPort: 8081
  targetPort: http
  managementTargetPort: management

# Deployment configuration
deployment:
  # Number of replicas (should be 1 for file-based queue management)
  replicaCount: 1
  
  # Deployment strategy
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: 1
  
  # Pod disruption budget
  podDisruptionBudget:
    enabled: false
    minAvailable: 1
  
  # Annotations
  annotations: {}
  
  # Labels
  labels: {}

# Pod configuration
pod:
  # Security context
  securityContext: {}
  
  # Annotations
  annotations: {}
  
  # Labels
  labels: {}
  
  # Node selector
  nodeSelector: {}
  
  # Tolerations
  tolerations: []
  
  # Affinity
  affinity: {}

# Persistent volumes
persistence:
  # Shared directory for queue files
  # Required for file-based queue management across pod restarts
  shared:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 1Gi
    annotations: {}
  
  # Configuration persistence
  config:
    enabled: false
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 100Mi

# Service Account
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  name: ""

# RBAC configuration
rbac:
  # Create RBAC resources
  create: true
  # Rules for the kafka-proxy manager
  rules:
    - apiGroups: [""]
      resources: ["services", "pods", "configmaps"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["apps"]
      resources: ["deployments", "replicasets"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: kafka-proxy-manager.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Health checks
healthCheck:
  enabled: true
  livenessProbe:
    httpGet:
      path: /api/health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /api/health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Monitoring
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    path: /management/metrics

# Network policies
networkPolicy:
  enabled: false
  ingress: []
  egress: []

# Additional volumes
extraVolumes: []
extraVolumeMounts: []

# Additional containers
extraContainers: []

# Additional init containers
extraInitContainers: []

# Environment variables from secrets/configmaps
extraEnvFrom: []

# Additional environment variables
extraEnv: []