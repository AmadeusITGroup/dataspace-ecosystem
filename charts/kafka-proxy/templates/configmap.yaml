apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kafka-proxy.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "kafka-proxy.labels" . | nindent 4 }}
data:
  configuration.properties: |
    # Web HTTP Configuration
    web.http.port=8080
    web.http.path=/api
    web.http.management.port=8081
    web.http.management.path=/management
    
    # Kafka Proxy Configuration
    kafka.proxy.vault.addr={{ .Values.kafkaProxy.manager.vaultAddr }}
    kafka.proxy.vault.token=${KAFKA_PROXY_VAULT_TOKEN}
    {{- if .Values.kafkaProxy.manager.vaultFolder }}
    kafka.proxy.vault.folder={{ .Values.kafkaProxy.manager.vaultFolder }}
    {{- end }}
    kafka.proxy.namespace={{ .Values.kafkaProxy.manager.namespace }}
    kafka.proxy.image={{ .Values.kafkaProxy.manager.proxyImage }}
    kafka.proxy.shared.dir={{ .Values.kafkaProxy.manager.sharedDir }}
    kafka.proxy.check.interval={{ .Values.kafkaProxy.manager.checkInterval }}
    kafka.proxy.enable.lock={{ .Values.kafkaProxy.manager.enableLock }}
    kafka.proxy.lock.file.path={{ .Values.kafkaProxy.manager.lockFilePath }}
    {{- if .Values.kafkaProxy.manager.participantId }}
    kafka.proxy.participant.id={{ .Values.kafkaProxy.manager.participantId }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.serviceClusterIP }}
    kafka.proxy.service.clusterIP={{ .Values.kafkaProxy.manager.serviceClusterIP }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.baseProxyPort }}
    kafka.proxy.base.port={{ .Values.kafkaProxy.manager.baseProxyPort }}
    {{- end }}
    
    # Downstream Authentication Configuration
    # How clients authenticate to the proxy listener
    kafka.proxy.auth.enabled={{ .Values.kafkaProxy.manager.auth.enabled }}
    {{- if .Values.kafkaProxy.manager.auth.mechanism }}
    kafka.proxy.auth.mechanism={{ .Values.kafkaProxy.manager.auth.mechanism }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.auth.tenantId }}
    kafka.proxy.auth.tenant.id={{ .Values.kafkaProxy.manager.auth.tenantId }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.auth.clientId }}
    kafka.proxy.auth.client.id={{ .Values.kafkaProxy.manager.auth.clientId }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.auth.staticUsers }}
    kafka.proxy.auth.static.users={{ .Values.kafkaProxy.manager.auth.staticUsers }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.auth.image }}
    kafka.proxy.auth.image={{ .Values.kafkaProxy.manager.auth.image }}
    {{- end }}
    
    # TLS Listener Configuration
    kafka.proxy.tls.listener.enabled={{ .Values.kafkaProxy.manager.tls.listener.enabled }}
    {{- if .Values.kafkaProxy.manager.tls.listener.certSecret }}
    kafka.proxy.tls.listener.cert.secret={{ .Values.kafkaProxy.manager.tls.listener.certSecret }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.tls.listener.keySecret }}
    kafka.proxy.tls.listener.key.secret={{ .Values.kafkaProxy.manager.tls.listener.keySecret }}
    {{- end }}
    {{- if .Values.kafkaProxy.manager.tls.listener.caSecret }}
    kafka.proxy.tls.listener.ca.secret={{ .Values.kafkaProxy.manager.tls.listener.caSecret }}
    {{- end }}
    
    # Pod Labels Configuration (applied to dynamically created Kafka proxy pods)
    {{- if .Values.pod.labels }}
    {{- $labels := list }}
    {{- range $key, $value := .Values.pod.labels }}
    {{- $labels = append $labels (printf "%s=%s" $key $value) }}
    {{- end }}
    kafka.proxy.pod.labels={{ join "," $labels }}
    {{- end }}
    
    # EDC Runtime Configuration (optional)
    {{- if .Values.kafkaProxy.manager.edc.runtimeId }}
    edc.runtime.id={{ .Values.kafkaProxy.manager.edc.runtimeId }}
    {{- end }}