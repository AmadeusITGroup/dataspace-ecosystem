# Kafka Proxy Kubernetes Manager Configuration with OAuth2/OIDC Authentication

# Vault Configuration
kafka.proxy.vault.addr=http://vault:8200
kafka.proxy.vault.token=root

# Check interval in seconds
kafka.proxy.check.interval=15

# Lock configuration
kafka.proxy.enable.lock=true
kafka.proxy.lock.file.path=/tmp/kubectl-deployer.lock

# Shared directory for queue files
kafka.proxy.shared.dir=/shared

# Kubernetes configuration
kafka.proxy.namespace=default
kafka.proxy.image=grepplabs/kafka-proxy:0.4.2

# ============================================================================
# OAuth2/OIDC Authentication Configuration for Consumer Proxies
# ============================================================================
# IMPORTANT: All consumer proxies created by this manager will use the same
# OAuth2 configuration (tenant-id, client-id, static-users).
# ============================================================================

# Enable OAuth2 authentication for all consumer proxies
kafka.proxy.oauth2.enable=true

# Microsoft Entra ID (Azure AD) tenant ID
# Get this from Azure Portal > Microsoft Entra ID > Overview > Tenant ID
kafka.proxy.oauth2.tenant-id=<your-tenant-id>

# Application client ID registered in Entra ID
# Get this from Azure Portal > App Registrations > Your App > Application (client) ID
kafka.proxy.oauth2.client-id=<your-client-id>

# Static users for fallback authentication (comma-separated username:password pairs)
# These users can authenticate without OAuth2 tokens using SASL PLAIN
# Format: username1:password1,username2:password2
kafka.proxy.oauth2.static-users=admin:admin-secret,service-account:service-pass

# Custom Docker image with OAuth2 plugins embedded
# This image must include the entra-token-verifier and entra-token-provider plugins
# Build using: ./gradlew :plugins:podmanize
# Load to Kind using: ./gradlew :plugins:loadToKind
kafka.proxy.oauth2.plugin-image=kafka-proxy-entra-auth:latest

# Logging
web.http.port=8080
web.http.path=/api

# EDC Runtime
edc.runtime.id=kafka-proxy-k8s-manager

# ============================================================================
# How OAuth2 Authentication Works
# ============================================================================
# 1. Consumer applications obtain OAuth2 access tokens from Entra ID:
#    - Scope: <client-id>/.default (e.g., <your-client-id>/.default)
#    - Use Azure SDKs (DefaultAzureCredential, etc.) to get tokens
#
# 2. Consumers connect to Kafka proxy using SASL PLAIN:
#    - Username: Any value (e.g., "oauth2")
#    - Password: The OAuth2 access token
#
# 3. The entra-token-verifier plugin validates the token:
#    - Checks token signature and claims against Entra ID
#    - Falls back to static user authentication if token is invalid
#
# 4. If authentication succeeds, the proxy forwards requests to Kafka brokers
# ============================================================================


# from kafka import KafkaConsumer
# from azure.identity import DefaultAzureCredential
#
# # Get OAuth2 token
# credential = DefaultAzureCredential()
# token = credential.get_token("<your-client-id>/.default")
#
# # Connect with OAuth2 token as password
# consumer = KafkaConsumer(
#     'my-topic',
#     bootstrap_servers=['kafka-proxy-service:30001'],
#     security_protocol='SASL_PLAINTEXT',
#     sasl_mechanism='PLAIN',
#     sasl_plain_username='oauth2',
#     sasl_plain_password=token.token
# )
# ============================================================================
